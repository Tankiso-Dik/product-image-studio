<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scene 02 Builder</title>
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/builder.css">
  </head>
  <body class="builder-page">
    <main class="builder-container">
      <h1 class="builder-title">Scene 02 â€” Feature Spotlight</h1>
      <form class="builder-form" onsubmit="return false;">
        <div class="field">
          <label for="theme">Theme</label>
          <input type="text" id="theme" placeholder="green | yellow | purple" value="purple">
        </div>
        <div class="field">
          <label for="url">URL (address bar)</label>
          <input type="text" id="url" placeholder="example.com" value="example.com">
        </div>
        <div class="field">
          <label for="title">Main Heading</label>
          <input type="text" id="title" placeholder="Your Product Name" value="Make progress visible">
        </div>
        <div class="field">
          <label for="subtitle">Subheading</label>
          <input type="text" id="subtitle" placeholder="Concise, compelling subheading" value="A simple system that rewards steady wins">
        </div>
        <div class="field">
          <label for="image">Step Screenshot (URL)</label>
          <input type="text" id="image" placeholder="assets/screenshots/step.png">
        </div>
        <div class="field">
          <label for="imageFile">Or pick a step file</label>
          <input type="file" id="imageFile" accept="image/*">
        </div>
        <div class="field">
          <label for="label">Step Label</label>
          <input type="text" id="label" placeholder="Step" value="Step">
        </div>
        <div class="field">
          <label for="text">Step Instruction</label>
          <input type="text" id="text" placeholder="Short instruction goes here">
        </div>
        <div class="actions">
          <button id="applyBtn" type="button">Apply</button>
          <a id="openScene" href="/scenes/02-feature.html" target="_blank">Open Scene</a>
        </div>
      </form>
    </main>
    <script>
      const q = (id)=>document.getElementById(id);
      const toDataURL = (file)=> new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file) });
      async function payload(){
        const p={
          scene: '02-feature',
          addressBar: (q('url').value||'').trim(),
          mainHeading: (q('title').value||'').trim(),
          subHeading: (q('subtitle').value||'').trim(),
          theme: (q('theme').value||'').trim(),
          browserScreenshot: (q('image').value||'').trim(),
          stepLabel: (q('label').value||'').trim(),
          stepText: (q('text').value||'').trim()
        };
        const f=q('imageFile')?.files?.[0]; if(f){ try{ p.browserScreenshot=await toDataURL(f) }catch(e){} }
        return p;
      }
      q('applyBtn').addEventListener('click', async ()=>{
        const body = await payload();
        const res = await fetch('/api/compose', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
        const html = await res.text();
        const compose = window.open('/scenes/02-feature.html', '_blank');
        const w = compose || window;
        w.document.open();
        w.document.write(html);
        w.document.close();
      });
    </script>
  </body>
</html>
